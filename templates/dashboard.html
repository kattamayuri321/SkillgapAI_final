<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillGapAI Dashboard - Skills Analysis Overview</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .dashboard-header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .dashboard-header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e1e8ed;
        }

        .dashboard-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }


        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }



        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .back-button:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        /* 1x4 Matrix Layout */
        .matrix-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .matrix-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e1e8ed;
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .matrix-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }

        .matrix-card .card-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .matrix-card h3 {
            color: #2c3e50;
            margin: 10px 0;
            font-size: 1.1em;
        }

        .matrix-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 15px 0;
            color: #2c3e50;
        }

        .matrix-desc {
            color: #6b7280;
            font-size: 0.9em;
            margin: 5px 0 15px 0;
        }

        .matrix-skills {
            margin-top: 15px;
        }

        .skill-preview {
            display: inline-block;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            color: #6b7280;
            margin: 2px;
        }

        /* Card specific colors */
        .match-percentage-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .match-percentage-card h3,
        .match-percentage-card .matrix-value,
        .match-percentage-card .matrix-desc {
            color: white;
        }

        .matched-card {
            border-left: 4px solid #10b981;
        }

        .partial-card {
            border-left: 4px solid #f59e0b;
        }

        .missing-card {
            border-left: 4px solid #ef4444;
        }

        .charts-section {
            margin-top: 20px;
        }

        /* Skill Comparison Section */
        .comparison-section {
            margin-top: 40px;
        }

        .comparison-section h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-bottom: 20px;
        }

        .comparison-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e1e8ed;
        }

        .comparison-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .skill-breakdown {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .skill-category {
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 15px;
        }

        .skill-category h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 1em;
        }

        .skill-count {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .skill-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .skill-tag-small {
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            color: #6b7280;
            border: 1px solid #e1e8ed;
        }

        .analysis-breakdown {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .analysis-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .analysis-item:last-child {
            border-bottom: none;
        }

        .analysis-label {
            font-weight: 500;
            color: #6b7280;
        }

        .analysis-value {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1em;
        }

        /* Upskilling Recommendations Section */
        .recommendations-section {
            margin-top: 40px;
        }

        .recommendations-section h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        .recommendations-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-bottom: 30px;
        }

        .recommendation-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e1e8ed;
            border-left: 4px solid;
        }

        .priority-high { border-left-color: #ef4444; }
        .priority-medium { border-left-color: #f59e0b; }
        .priority-low { border-left-color: #10b981; }

        .rec-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .rec-header h3 {
            margin: 0;
            color: #2c3e50;
        }

        .rec-badge {
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
            color: #6b7280;
        }

        .rec-desc {
            color: #6b7280;
            font-size: 0.9em;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .rec-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .rec-skill-tag {
            background: #667eea;
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .no-skills {
            color: #9ca3af;
            font-style: italic;
            font-size: 0.9em;
        }

        .action-plan-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 30px;
            margin-top: 20px;
        }

        .action-plan-card h3 {
            margin-bottom: 25px;
            font-size: 1.4em;
            text-align: center;
        }

        .action-steps {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .action-step {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .step-number {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content h4 {
            margin: 0 0 5px 0;
            color: white;
            font-size: 1.1em;
        }

        .step-content p {
            margin: 0;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.4;
        }

        @media (max-width: 1024px) {
            .comparison-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .recommendations-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .matrix-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .comparison-grid {
                grid-template-columns: 1fr;
            }

            .recommendations-container {
                grid-template-columns: 1fr;
            }

            .matrix-value {
                font-size: 2em;
            }

            .matrix-card h3 {
                font-size: 1em;
            }

            .comparison-section h2,
            .recommendations-section h2 {
                font-size: 1.5em;
            }
        }

        @media (max-width: 480px) {
            .matrix-container {
                grid-template-columns: 1fr;
            }

            .matrix-card {
                padding: 20px;
            }

            .matrix-value {
                font-size: 1.8em;
            }

            .comparison-card,
            .recommendation-card {
                padding: 20px;
            }

            .action-plan-card {
                padding: 20px;
            }

            .action-step {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <a href="/" class="back-button">
        <span>‚Üê</span>
        Back to Analysis
    </a>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1>üìä Skills Analysis Dashboard</h1>
            <p>Comprehensive overview of your skill match analysis</p>
        </div>

        <!-- 1x4 Matrix Layout -->
        <div class="matrix-container">
            <!-- Overall Match Percentage -->
            <div class="matrix-card match-percentage-card">
                <div class="card-icon"></div>
                <h3>Overall Match</h3>
                <div class="matrix-value" id="overall-match">0%</div>
                <p class="matrix-desc">Based on job requirements</p>
            </div>

            <!-- Matching Skills -->
            <div class="matrix-card matched-card">
                <div class="card-icon"></div>
                <h3>Matching Skills</h3>
                <div class="matrix-value" id="matched-count">0</div>
                <p class="matrix-desc">Skills you have</p>
                <div class="matrix-skills" id="matched-skills-preview">
                    <span class="skill-preview">No skills</span>
                </div>
            </div>

            <!-- Partially Matching Skills -->
            <div class="matrix-card partial-card">
                <div class="card-icon"></div>
                <h3>Partial Matches</h3>
                <div class="matrix-value" id="partial-count">0</div>
                <p class="matrix-desc">Similar skills found</p>
                <div class="matrix-skills" id="partial-skills-preview">
                    <span class="skill-preview">No skills</span>
                </div>
            </div>

            <!-- Missing Skills -->
            <div class="matrix-card missing-card">
                <div class="card-icon"></div>
                <h3>Missing Skills</h3>
                <div class="matrix-value" id="missing-count">0</div>
                <p class="matrix-desc">Skills to develop</p>
                <div class="matrix-skills" id="missing-skills-preview">
                    <span class="skill-preview">No skills</span>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="dashboard-grid">
                <!-- Radar Chart -->
                <div class="dashboard-card">
                    <h3>üéØ Skills Comparison Radar</h3>
                    <div class="chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>

                <!-- Bar Chart -->
                <div class="dashboard-card">
                    <h3>üìä Resume vs Job Description Skills</h3>
                    <div class="chart-container">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
            </div>
        <!-- Skill Comparison Section -->
        <div class="comparison-section">
            <h2>üîç Detailed Skill Comparison</h2>
            <div class="comparison-grid">
                <div class="comparison-card">
                    <h3>üìù Your Resume Skills</h3>
                    <div class="skill-breakdown">
                        <div class="skill-category">
                            <h4>üíª Technical Skills</h4>
                            <div class="skill-count" id="resume-tech-count">0</div>
                            <div class="skill-list" id="resume-technical-skills"></div>
                        </div>
                        <div class="skill-category">
                            <h4>ü§ù Soft Skills</h4>
                            <div class="skill-count" id="resume-soft-count">0</div>
                            <div class="skill-list" id="resume-soft-skills"></div>
                        </div>
                    </div>
                </div>

                <div class="comparison-card">
                    <h3>üíº Job Requirements</h3>
                    <div class="skill-breakdown">
                        <div class="skill-category">
                            <h4>üíª Technical Skills</h4>
                            <div class="skill-count" id="jd-tech-count">0</div>
                            <div class="skill-list" id="jd-technical-skills"></div>
                        </div>
                        <div class="skill-category">
                            <h4>ü§ù Soft Skills</h4>
                            <div class="skill-count" id="jd-soft-count">0</div>
                            <div class="skill-list" id="jd-soft-skills"></div>
                        </div>
                    </div>
                </div>

                <div class="comparison-card analysis-card">
                    <h3>üìä Analysis Summary</h3>
                    <div class="analysis-breakdown">
                        <div class="analysis-item">
                            <span class="analysis-label">Total Resume Skills:</span>
                            <span class="analysis-value" id="total-resume-skills">0</span>
                        </div>
                        <div class="analysis-item">
                            <span class="analysis-label">Total Job Skills:</span>
                            <span class="analysis-value" id="total-jd-skills">0</span>
                        </div>
                        <div class="analysis-item">
                            <span class="analysis-label">Skills Gap:</span>
                            <span class="analysis-value" id="skills-gap">0</span>
                        </div>
                        <div class="analysis-item">
                            <span class="analysis-label">Match Rate:</span>
                            <span class="analysis-value" id="match-rate-percentage">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upskilling Recommendations Section -->
        <div class="recommendations-section">
            <h2>Upskilling Recommendations</h2>
            <div class="recommendations-container">
                <div class="recommendation-card priority-high">
                    <div class="rec-header">
                        <h3>üî¥ High Priority</h3>
                        <span class="rec-badge">Learn First</span>
                    </div>
                    <p class="rec-desc">Critical skills you're missing that are essential for this role</p>
                    <div class="rec-skills" id="high-priority-skills">
                        <span class="no-skills">No high priority skills identified</span>
                    </div>
                </div>

                <div class="recommendation-card priority-medium">
                    <div class="rec-header">
                        <h3>üü° Medium Priority</h3>
                        <span class="rec-badge">Build On Existing</span>
                    </div>
                    <p class="rec-desc">Skills you partially have - strengthen these to improve your match</p>
                    <div class="rec-skills" id="medium-priority-skills">
                        <span class="no-skills">No medium priority skills identified</span>
                    </div>
                </div>

                <div class="recommendation-card priority-low">
                    <div class="rec-header">
                        <h3>üü¢ Nice to Have</h3>
                        <span class="rec-badge">Optional</span>
                    </div>
                    <p class="rec-desc">Additional skills that could give you an edge in the role</p>
                    <div class="rec-skills" id="low-priority-skills">
                        <span class="no-skills">No additional skills suggested</span>
                    </div>
                </div>
            </div>

            <div class="action-plan-card">
                <h3>üìã Your 30-Day Action Plan</h3>
                <div class="action-steps">
                    <div class="action-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Week 1-2: Focus on High Priority Skills</h4>
                            <p>Dedicate time to learning the most critical missing skills through online courses, tutorials, or practical projects.</p>
                        </div>
                    </div>
                    <div class="action-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Week 3-4: Strengthen Similar Skills</h4>
                            <p>Build upon skills you already have by taking them to the next level or applying them in new contexts.</p>
                        </div>
                    </div>
                    <div class="action-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Ongoing: Track Progress</h4>
                            <p>Regularly update your resume and track your learning progress. Consider getting certifications for newly acquired skills.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load analysis data from localStorage or sessionStorage
        let analysisData = null;

        // Try to get data from various storage methods
        function loadAnalysisData() {
            // Check localStorage first
            const storedData = localStorage.getItem('skillGapAnalysisData');
            if (storedData) {
                try {
                    analysisData = JSON.parse(storedData);
                    return true;
                } catch (e) {
                    console.error('Error parsing stored data:', e);
                }
            }

            // Check sessionStorage
            const sessionData = sessionStorage.getItem('skillGapAnalysisData');
            if (sessionData) {
                try {
                    analysisData = JSON.parse(sessionData);
                    return true;
                } catch (e) {
                    console.error('Error parsing session data:', e);
                }
            }

            return false;
        }

        // Save data for dashboard access
        function saveAnalysisDataForDashboard(data) {
            localStorage.setItem('skillGapAnalysisData', JSON.stringify(data));
            sessionStorage.setItem('skillGapAnalysisData', JSON.stringify(data));
        }

        // Initialize dashboard
        function initializeDashboard() {
            if (!loadAnalysisData()) {
                alert('No analysis data found. Please run an analysis first.');
                window.location.href = '/';
                return;
            }

            renderDashboard();
        }

        // Render dashboard with data
        function renderDashboard() {
            if (!analysisData || !analysisData.analysis) {
                alert('Invalid analysis data. Please run an analysis first.');
                window.location.href = '/';
                return;
            }

            const analysis = analysisData.analysis;

            // Update overall match percentage
            document.getElementById('overall-match').textContent = Math.round(analysis.match_percentage) + '%';

            // Update matrix values
            document.getElementById('overall-match').textContent = Math.round(analysis.match_percentage) + '%';
            document.getElementById('matched-count').textContent = analysis.summary.matched_count;
            document.getElementById('missing-count').textContent = analysis.summary.missing_count;
            document.getElementById('partial-count').textContent = analysis.partially_matched.technical.length + analysis.partially_matched.soft.length;

            // Render skill previews in matrix cards
            renderSkillPreview('matched-skills-preview', [
                ...analysis.matched.technical,
                ...analysis.matched.soft
            ], 3);

            renderSkillPreview('partial-skills-preview', [
                ...analysis.partially_matched.technical.map(item => item.resume_skill),
                ...analysis.partially_matched.soft.map(item => item.resume_skill)
            ], 3);

            renderSkillPreview('missing-skills-preview', [
                ...analysis.missing.technical,
                ...analysis.missing.soft
            ], 3);

            // Populate skill comparison section
            populateSkillComparison(analysisData.resume_skills, analysisData.jd_skills, analysis);

            // Populate upskilling recommendations
            populateUpskillingRecommendations(analysis);

            // Create charts
            createRadarChart();
            createBarChart();
        }

        // Render skill preview for matrix cards
        function renderSkillPreview(containerId, skills, maxItems = 3) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (skills.length === 0) {
                container.innerHTML = '<span class="skill-preview">None</span>';
                return;
            }

            const displaySkills = skills.slice(0, maxItems);
            displaySkills.forEach(skill => {
                const skillElement = document.createElement('span');
                skillElement.className = 'skill-preview';
                skillElement.textContent = skill;
                container.appendChild(skillElement);
            });

            if (skills.length > maxItems) {
                const moreElement = document.createElement('span');
                moreElement.className = 'skill-preview';
                moreElement.textContent = `+${skills.length - maxItems} more`;
                container.appendChild(moreElement);
            }
        }

        // Render skills list (for detailed view if needed)
        function renderSkillsList(containerId, skills) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (skills.length === 0) {
                container.innerHTML = '<div class="skill-item">No skills in this category</div>';
                return;
            }

            skills.forEach(skill => {
                const skillElement = document.createElement('div');
                skillElement.className = 'skill-item';
                skillElement.textContent = skill;
                container.appendChild(skillElement);
            });
        }

        // Render partial skills list with similarity
        function renderPartialSkillsList(containerId, partialSkills) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (partialSkills.length === 0) {
                container.innerHTML = '<div class="skill-item">No skills found in this category</div>';
                return;
            }

            partialSkills.forEach(item => {
                const skillElement = document.createElement('div');
                skillElement.className = 'skill-item';
                skillElement.innerHTML = `${item.resume_skill} ‚Üí ${item.jd_skill} <small>(${Math.round(item.similarity * 100)}% match)</small>`;
                container.appendChild(skillElement);
            });
        }

        // Create bar chart comparing resume vs job description skills
        function createBarChart() {
            const ctx = document.getElementById('barChart').getContext('2d');

            const resumeSkills = analysisData.resume_skills;
            const jdSkills = analysisData.jd_skills;

            const resumeTech = resumeSkills.technical.length;
            const resumeSoft = resumeSkills.soft.length;
            const jdTech = jdSkills.technical.length;
            const jdSoft = jdSkills.soft.length;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Technical Skills', 'Soft Skills'],
                    datasets: [{
                        label: 'Your Resume',
                        data: [resumeTech, resumeSoft],
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: '#667eea',
                        borderWidth: 1
                    }, {
                        label: 'Job Requirements',
                        data: [jdTech, jdSoft],
                        backgroundColor: 'rgba(16, 185, 129, 0.8)',
                        borderColor: '#10b981',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Populate skill comparison section
        function populateSkillComparison(resumeSkills, jdSkills, analysis) {
            // Resume skills
            document.getElementById('resume-tech-count').textContent = resumeSkills.technical.length;
            document.getElementById('resume-soft-count').textContent = resumeSkills.soft.length;
            renderSkillTags('resume-technical-skills', resumeSkills.technical);
            renderSkillTags('resume-soft-skills', resumeSkills.soft);

            // Job description skills
            document.getElementById('jd-tech-count').textContent = jdSkills.technical.length;
            document.getElementById('jd-soft-count').textContent = jdSkills.soft.length;
            renderSkillTags('jd-technical-skills', jdSkills.technical);
            renderSkillTags('jd-soft-skills', jdSkills.soft);

            // Analysis summary
            const totalResume = resumeSkills.technical.length + resumeSkills.soft.length;
            const totalJd = jdSkills.technical.length + jdSkills.soft.length;

            // Use actual missing skills count from analysis to show a real skills gap,
            // instead of just subtracting totals (which can often be 0).
            const skillsGapCount =
                (analysis?.summary?.missing_count ?? 0) ||
                (analysis?.missing?.technical?.length ?? 0) +
                (analysis?.missing?.soft?.length ?? 0);

            document.getElementById('total-resume-skills').textContent = totalResume;
            document.getElementById('total-jd-skills').textContent = totalJd;
            document.getElementById('skills-gap').textContent = skillsGapCount;
            document.getElementById('match-rate-percentage').textContent = Math.round(analysis.match_percentage) + '%';
        }

        // Render skill tags for comparison section
        function renderSkillTags(containerId, skills) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (skills.length === 0) {
                container.innerHTML = '<span class="skill-tag-small">No skills</span>';
                return;
            }

            skills.forEach(skill => {
                const skillElement = document.createElement('span');
                skillElement.className = 'skill-tag-small';
                skillElement.textContent = skill;
                container.appendChild(skillElement);
            });
        }

        // Populate upskilling recommendations
        function populateUpskillingRecommendations(analysis) {
            // High priority: missing technical skills
            const highPrioritySkills = [
                ...analysis.missing.technical.slice(0, 4), // Top 4 missing technical
                ...analysis.missing.soft.slice(0, 2)       // Top 2 missing soft
            ];
            renderRecommendationSkills('high-priority-skills', highPrioritySkills);

            // Medium priority: partially matched skills (what to improve)
            const mediumPrioritySkills = [
                ...analysis.partially_matched.technical.map(item => item.jd_skill).slice(0, 3),
                ...analysis.partially_matched.soft.map(item => item.jd_skill).slice(0, 2)
            ];
            renderRecommendationSkills('medium-priority-skills', mediumPrioritySkills);

            // Low priority: additional skills from extra categories or advanced skills
            const lowPrioritySkills = [
                ...analysis.extra.technical.slice(0, 2), // Some extra technical as "nice to have"
                ...analysis.extra.soft.slice(0, 2)        // Some extra soft skills
            ];
            renderRecommendationSkills('low-priority-skills', lowPrioritySkills);
        }

        // Create radar chart
        function createRadarChart() {
            const radarCanvas = document.getElementById('radarChart');
            if (!radarCanvas) return;

            const ctx = radarCanvas.getContext('2d');
            const analysis = analysisData.analysis;
            const resumeSkills = analysisData.resume_skills;
            const jdSkills = analysisData.jd_skills;

            // NOTE: A radar chart with only 2 axes collapses into a single line.
            // Use 6 axes so it renders as a clear polygon/hexagon-like shape.
            const matchedCount = (analysis?.summary?.matched_count ?? 0);
            const missingCount = (analysis?.summary?.missing_count ?? 0);
            const partialCount =
                (analysis?.partially_matched?.technical?.length ?? 0) +
                (analysis?.partially_matched?.soft?.length ?? 0);

            const totalResume = (resumeSkills?.technical?.length ?? 0) + (resumeSkills?.soft?.length ?? 0);
            const totalJd = (jdSkills?.technical?.length ?? 0) + (jdSkills?.soft?.length ?? 0);

            const categories = [
                'Technical',
                'Soft',
                'Matched',
                'Partial',
                'Missing',
                'Total'
            ];

            const resumeData = [
                resumeSkills.technical.length,
                resumeSkills.soft.length,
                matchedCount,
                partialCount,
                missingCount,
                totalResume
            ];

            const jdData = [
                jdSkills.technical.length,
                jdSkills.soft.length,
                matchedCount,
                partialCount,
                missingCount,
                totalJd
            ];

            const maxValue = Math.max(...resumeData, ...jdData, 1);

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: categories,
                    datasets: [
                        {
                            label: 'Your Resume',
                            data: resumeData,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: '#667eea',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: '#667eea'
                        },
                        {
                            label: 'Job Requirements',
                            data: jdData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: '#10b981',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: '#10b981'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            suggestedMax: maxValue,
                            grid: {
                                circular: false,
                                color: 'rgba(44, 62, 80, 0.18)'
                            },
                            angleLines: {
                                display: true,
                                color: 'rgba(44, 62, 80, 0.18)'
                            },
                            pointLabels: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                },
                                color: '#2c3e50'
                            },
                            ticks: {
                                stepSize: 1,
                                backdropColor: 'rgba(255, 255, 255, 0.85)',
                                color: '#6b7280'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Render recommendation skills
        function renderRecommendationSkills(containerId, skills) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (skills.length === 0) {
                return; // Keep the default "no skills" message
            }

            skills.forEach(skill => {
                const skillElement = document.createElement('span');
                skillElement.className = 'rec-skill-tag';
                skillElement.textContent = skill;
                container.appendChild(skillElement);
            });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeDashboard);

        // Make saveAnalysisDataForDashboard available globally for the main app
        window.saveAnalysisDataForDashboard = saveAnalysisDataForDashboard;
</script>
</body>
</html>